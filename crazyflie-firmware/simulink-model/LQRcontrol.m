% State vector = [a1 a2 v1 v2 v3 w1 w2 w3]
% A = [ 0         0         0         0         0    1.0000         0         0
%          0         0         0         0         0         0    1.0000         0
%          0    9.8103         0         0         0         0         0         0
%    -9.8103         0         0         0         0         0         0         0
%          0         0         0         0         0         0         0         0
%          0         0         0         0         0         0         0         0
%          0         0         0         0         0         0         0         0
%          0         0         0         0         0         0         0         0];
% 
% B =     [0         0         0         0
%          0         0         0         0
%          0         0         0         0
%          0         0         0         0
%         37.03703704  37.03703704  37.03703704  37.03703704
%        -2331.678275 -2331.678275  2331.678275  2331.678275
%        -2265.105288  2265.105288  2265.105288 -2265.105288
%        -1673430.113  1673430.113 -1673430.113  1673430.113];
%    
% C =    [0         0         0         0         0   57.2958         0         0
%          0         0         0         0         0         0   57.2958         0
%          0         0         0         0         0         0         0   57.2958
%          0         0    1.0000         0         0         0         0         0
%          0         0         0    1.0000         0         0         0         0
%          0         0         0         0    1.0000         0         0         0
%    57.2958         0         0         0         0         0         0         0
%          0   57.2958         0         0         0         0         0         0];
%      
% D = [0     0     0     0
%      0     0     0     0
%      0     0     0     0
%      0     0     0     0
%      0     0     0     0
%      0     0     0     0
%      0     0     0     0
%      0     0     0     0];
 
A = [ 0     0     1     0     0
     0     0     0     1     0
     0     0     0     0     0
     0     0     0     0     0
     0     0     0     0     0];

B = [0	0	0	0
	 0	0	0	0
	-0.02094	-0.02094	0.02094     0.02094
    -0.02034	0.02034     0.02034     -0.02034
	-15.03      15.03       -15.03      15.03];
   
C =    [57.2958   0          0         0         0
         0   57.2958         0         0         0
         0         0   57.2958         0         0
         0         0         0   57.2958         0
         0         0         0         0   57.2958];
     
D = [0     0     0     0
     0     0     0     0
     0     0     0     0
     0     0     0     0
     0     0     0     0];
 


Ai = [A zeros(size(A,1),3); -C([1 2 5],:) zeros(3)];
Bi = [B; zeros(3,size(B,2))];
Ci = [C zeros(size(C,1),3)];%;zeros(3,size(C,2)) eye(3)];
Di = zeros(size(Ci,1),4);

sysc = ss(Ai,Bi,Ci,Di);

%Discretize system
Ts = 0.01;
sysd = c2d(sysc,Ts);

% Calculate LQR Control Gain
% Set LQR weighting matrices.
Q = diag([10 10 .1 .1 .1 1000 1000 1000]);
R = 0.0000001*eye(4);

% Calculate control gain using LQR optimization.
KLQR = dlqr(sysd.A,sysd.B,Q,R);
