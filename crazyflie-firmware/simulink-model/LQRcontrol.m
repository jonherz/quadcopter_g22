% State vector = [a1 a2 v1 v2 v3 w1 w2 w3]
% A = [ 0         0         0         0         0    1.0000         0         0
%          0         0         0         0         0         0    1.0000         0
%          0    9.8103         0         0         0         0         0         0
%    -9.8103         0         0         0         0         0         0         0
%          0         0         0         0         0         0         0         0
%          0         0         0         0         0         0         0         0
%          0         0         0         0         0         0         0         0
%          0         0         0         0         0         0         0         0];
% 
% B =     [0         0         0         0
%          0         0         0         0
%          0         0         0         0
%          0         0         0         0
%         37.03703704  37.03703704  37.03703704  37.03703704
%        -2331.678275 -2331.678275  2331.678275  2331.678275
%        -2265.105288  2265.105288  2265.105288 -2265.105288
%        -1673430.113  1673430.113 -1673430.113  1673430.113];
%    
% C =    [0         0         0         0         0   57.2958         0         0
%          0         0         0         0         0         0   57.2958         0
%          0         0         0         0         0         0         0   57.2958
%          0         0    1.0000         0         0         0         0         0
%          0         0         0    1.0000         0         0         0         0
%          0         0         0         0    1.0000         0         0         0
%    57.2958         0         0         0         0         0         0         0
%          0   57.2958         0         0         0         0         0         0];
%      
% D = [0     0     0     0
%      0     0     0     0
%      0     0     0     0
%      0     0     0     0
%      0     0     0     0
%      0     0     0     0
%      0     0     0     0
%      0     0     0     0];
 
A = [ 0     0     1     0     0
     0     0     0     1     0
     0     0     0     0     0
     0     0     0     0     0
     0     0     0     0     0];

B =     [0,            0,            0,            0
         0,            0,            0,            0
         -2331.678275, -2331.678275,  2331.678275,  2331.678275
         -2265.105288,  2265.105288,  2265.105288, -2265.105288
         -1673430.113,  1673430.113, -1673430.113,  1673430.113];
   
C =    [0         0   57.2958         0         0
         0         0         0   57.2958         0
         0         0         0         0   57.2958
   57.2958         0         0         0         0
         0   57.2958         0         0         0];
     
D = [0     0     0     0
     0     0     0     0
     0     0     0     0
     0     0     0     0
     0     0     0     0];
 
sysc = ss(A,B,C,D);

%Discretize system
Ts = 0.01;
sysd = c2d(sysc,Ts);

Adi = [sysd.A zeros(size(sysd.A,1),3); -C([1 2 5],:) eye(3)];
Bdi = [sysd.B; zeros(3,size(sysd.B,2))];
C1i = [C zeros(size(C,1),3);zeros(3,size(C,2)) eye(3)];
D1i = zeros(size(C1i,1),4);

% DT State-Space
%sysdi = ss(Adi,Bdi,C1i,D1i,Ts);

% Calculate LQR Control Gain
% Set LQR weighting matrices.
Q = diag([1 1 10 10 50 10000 10000 10000]);
R = 1*eye(4);

% Calculate control gain using LQR optimization.
KLQR = dlqr(Adi,Bdi,Q,R);
KLQR(:,6:8) = KLQR(:,6:8)*10000
